package com.cg.model;

import jakarta.persistence.*;
import java.util.ArrayList;
import java.util.List;

import com.fasterxml.jackson.annotation.JsonIgnore;

@Entity
@Table(name = "doctor") // optional; helps keep a consistent table name
public class Doctor {

    // ---------- Columns ----------
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false) // a doctor should have a name
    private String name;

    private String qualification;

    @Column(name = "years_of_experience")
    private int yearsOfExperience;

    @Column(name = "consultation_fee")
    private double consultationFee;

    // ---------- Relationships ----------
    @ManyToOne(fetch = FetchType.LAZY, optional = false)
    @JoinColumn(name = "department_id", nullable = false)
    private Department department;

    // One Doctor -> Many Appointments
    @JsonIgnore // prevent recursive JSON if ever exposed via REST
    @OneToMany(mappedBy = "doctor", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Appointment> appointments = new ArrayList<>();

    // One Doctor -> Many Medical Records
    @JsonIgnore
    @OneToMany(mappedBy = "doctor", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<MedicalRecord> medicalRecords = new ArrayList<>();

    // ---------- Constructors ----------
    public Doctor() {
        // Required by JPA / Hibernate
    }

    public Doctor(Long id,
                  String name,
                  String qualification,
                  int yearsOfExperience,
                  double consultationFee,
                  Department department) {
        this.id = id;
        this.name = name;
        this.qualification = qualification;
        this.yearsOfExperience = yearsOfExperience;
        this.consultationFee = consultationFee;
        this.department = department;
    }

    // ---------- Getters & Setters ----------
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getQualification() {
        return qualification;
    }

    public void setQualification(String qualification) {
        this.qualification = qualification;
    }

    public int getYearsOfExperience() {
        return yearsOfExperience;
    }

    public void setYearsOfExperience(int yearsOfExperience) {
        this.yearsOfExperience = yearsOfExperience;
    }

    public double getConsultationFee() {
        return consultationFee;
    }

    public void setConsultationFee(double consultationFee) {
        this.consultationFee = consultationFee;
    }

    public Department getDepartment() {
        return department;
    }

    public void setDepartment(Department department) {
        this.department = department;
    }

    public List<Appointment> getAppointments() {
        return appointments;
    }

    public void setAppointments(List<Appointment> appointments) {
        this.appointments = appointments != null ? appointments : new ArrayList<>();
    }

    public List<MedicalRecord> getMedicalRecords() {
        return medicalRecords;
    }

    public void setMedicalRecords(List<MedicalRecord> medicalRecords) {
        this.medicalRecords = medicalRecords != null ? medicalRecords : new ArrayList<>();
    }

    // ---------- Convenience Methods (keep both sides in sync) ----------
    public void addAppointment(Appointment appt) {
        if (appt == null) return;
        appointments.add(appt);
        appt.setDoctor(this);
    }

    public void removeAppointment(Appointment appt) {
        if (appt == null) return;
        appointments.remove(appt);
        if (appt.getDoctor() == this) {
            appt.setDoctor(null);
        }
    }

    public void addMedicalRecord(MedicalRecord record) {
        if (record == null) return;
        medicalRecords.add(record);
        record.setDoctor(this);
    }

    public void removeMedicalRecord(MedicalRecord record) {
        if (record == null) return;
        medicalRecords.remove(record);
        if (record.getDoctor() == this) {
            record.setDoctor(null);
        }
    }

    // ---------- equals/hashCode (optional; helpful in Sets) ----------
    // You can generate based on id only. For brevity, omitted here.
}